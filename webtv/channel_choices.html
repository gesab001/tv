<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
</head>

<style>
#pageTitle{
 text-align: center;
}
#containerList{
  display:flex;
  justify-content: center;
    flex-wrap: wrap;

  width: 100%;
}

.title{
  font-size: 16px;
  font-family: Arial;
}
.cardContainer{
   width: 400px;
   height: 400px;
   padding: 10px;

}
</style>
<body>


<h1 id="pageTitle"></h1>
<button onclick="play()">Play All</button>
<button onclick="loadNewVideos()">Load new videos</button>


<div id="containerList" >

</div>


</body>

<script>

function loadNewVideos(){
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
		   // Typical action to be performed when the document is ready:
		   alert(xhttp.responseText);
		   console.log(xhttp.responseText);
		}
	};
	xhttp.open("GET", "cgi-bin/loadNewVideos.py", true);
	xhttp.send();
}


function fetchVideos(data){
	var containerList = document.getElementById("containerList");
	channelNumber = 0;
	for (channel in data["channels"]){
		channelNumber = channelNumber + 1;
		var jsonItem = data["channels"][channel];
		var channelName = jsonItem["channelName"];
		var videos = jsonItem["videos"];
        var videoTitle = videos[0]["title"];
		console.log(videoTitle);

		var videoUrl = videos[0]["url"];
		console.log(videoUrl);

		var cardContainer = document.createElement("DIV");
		cardContainer.className = "cardContainer"; 
				var gameUrlEl = document.createElement("DIV");

		var channelEl = document.createElement("DIV");
		var videoTitleEl = document.createElement("DIV");

		channelEl.innerHTML = channelNumber + ". " + channelName;
		channelEl.className = "title";
		const video = document.createElement("video");

		// Set the video's attributes
		video.src = videoUrl;
		video.autoplay = false;
		video.controls = true;
		video.width = 400;
		video.height = 400;
		video.padding = "10px";

		
		videoTitleEl.innerHTML = videoTitle ;

		gameUrlEl.appendChild(video);
		gameUrlEl.appendChild(channelEl);
		gameUrlEl.appendChild(videoTitleEl);
		cardContainer.appendChild(gameUrlEl)
		containerList.appendChild(cardContainer);
		
		
		

	}
	
}

function fetchTitles(filename){
	
fetch(filename)
  .then((response) => response.json())
  .then(fetchVideos);
  
}


</script>

<script>
var url = window.location.pathname;
var jsonfilename = url.substring(url.lastIndexOf('/')+1).replace("html", "json");	
var pageTitle = url.substring(url.lastIndexOf('/')+1).replace(".html", "");
pageTitle = pageTitle.replace(/_/g, " ").toUpperCase();
console.log(pageTitle);
document.getElementById("pageTitle").innerHTML = pageTitle;
console.log(jsonfilename);
fetchTitles(jsonfilename);

function play(){
   videoEl = document.getElementsByTagName("VIDEO");
   console.log(videoEl);
   for (var x=0; x< videoEl.length; x++){
       var video = videoEl[x];
       video.play();
	   video.muted = true;
	   
   }
}
</script>

		   <script>
           let timeout; 


		   var channelNumber = "";
           var currentChannel = 1;
		   

           function isNumber(value) {
                return !isNaN(value);
           }
		   
		   function exitChannel(){
		           var  videoEl = document.getElementsByTagName("VIDEO");
		   var numberOfChannels = videoEl.length;
				  				  console.log("numberOfChannels: " + numberOfChannels);
				var video = videoEl[parseInt(currentChannel) -1];
				video.muted = true;
				console.log(video);
				var elem = video;
				if (elem.exitFullscreen) {
				  elem.exitFullscreen();
				} else if (elem.mozExitFullScreen) {
				  elem.mozExitFullScreen();
				} else if (elem.webkitExitFullscreen) {
				  elem.webkitExitFullscreen();
				} else if (elem.msExitFullscreen) { 
				  elem.msExitFullscreen();
				}
	          		   
		   }
		   function changeChannel(channelNumber){
		           var  videoEl = document.getElementsByTagName("VIDEO");
		   var numberOfChannels = videoEl.length;
				  				  console.log("numberOfChannels: " + numberOfChannels);
				currentChannel = channelNumber;				  
				var video = videoEl[parseInt(channelNumber) -1];
				video.muted = false;
				console.log(video);
				var elem = video;
				if (elem.requestFullscreen) {
				  elem.requestFullscreen();
				} else if (elem.mozRequestFullScreen) {
				  elem.mozRequestFullScreen();
				} else if (elem.webkitRequestFullscreen) {
				  elem.webkitRequestFullscreen();
				} else if (elem.msRequestFullscreen) { 
				  elem.msRequestFullscreen();
				}
	          
			  
			}
			document.onkeyup = function (e) {
               e = e || window.event;
               // use e.keyCode
			      console.log(e.key);
				  var channel = e.key;
				  channelNumber = channelNumber.toString() + channel.toString() ;
			
				  
				  clearTimeout(timeout);

				  timeout = setTimeout(function() { 
				  // Put your code here that you want to run 
				  // after the user has stopped typing for a little bit 
				  				  console.log("channelNumber: " + channelNumber);
		           var  videoEl = document.getElementsByTagName("VIDEO");
		   var numberOfChannels = videoEl.length;
				  				  console.log("numberOfChannels: " + numberOfChannels);		
									 if (parseInt(channelNumber)<=numberOfChannels && parseInt(channelNumber)>0){
									    exitChannel();
										changeChannel(channelNumber);
									 }
								  
								  
								  channelNumber = "";

				  
				  }, 800);


               };


		   </script>
</html>